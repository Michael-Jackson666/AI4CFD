# TNN 教程

## 概述

本教程全面介绍如何使用**张量神经网络（TNN）**求解高维偏微分方程（PDE）。教程使用 PyTorch 从零实现 TNN，并以二维 Poisson 方程为例进行演示。

## 什么是 TNN？

张量神经网络是一种专为高维 PDE 问题设计的神经网络架构。它利用**张量分解**将解表示为：

$$
u(x_1, x_2, \ldots, x_d) = \sum_{k=1}^{r} \prod_{i=1}^{d} \phi_i^{(k)}(x_i)
$$

其中：
- $r$ 是**秩**（分解的项数）
- $\phi_i^{(k)}$ 是每个维度的一维神经网络
- 参数量从 $O(N^d)$ 降低到 $O(drN)$

## 教程内容

### 1. 引言
- TNN 概述与优势
- 与标准神经网络的对比
- 教程路线图

### 2. 准备工作
- 导入库（PyTorch、NumPy、Matplotlib）
- 中文字体配置

### 3. 核心组件实现

#### 3.1 边界函数
- `bd(x)`：边界距离函数
- `grad_bd(x)`：边界函数的梯度
- `grad_grad_bd(x)`：边界函数的 Hessian
- 用途：强制齐次 Dirichlet 边界条件

#### 3.2 TNN 线性层
- 自定义线性变换层
- 张量分解的批处理
- 权重形状：`[dim, n_out, n_in]`

#### 3.3 激活函数（TNN_Sin）
- 正弦激活：$\sigma(x) = \sin(x)$
- 一阶导数：$\sigma'(x) = \cos(x)$
- 二阶导数：$\sigma''(x) = -\sin(x)$
- 光滑且周期性，适合 PDE 问题

#### 3.4 完整 TNN 模型
- `SimpleTNN` 类实现
- 支持计算函数值、梯度和 Hessian
- 自动边界条件强制
- 正交权重初始化

### 4. 应用：二维 Poisson 方程

**问题**：在 $\Omega = [-1, 1]^2$ 上求解以下 PDE：

$$
\begin{cases}
-\Delta u = f(x, y) & \text{in } \Omega \\
u = 0 & \text{on } \partial\Omega
\end{cases}
$$

其中 $f(x, y) = 2\pi^2 \sin(\pi x) \sin(\pi y)$

**精确解**：$u(x, y) = \sin(\pi x) \sin(\pi y)$

**变分形式**：最小化能量泛函

$$
E(u) = \frac{1}{2}\int_\Omega |\nabla u|^2 dx - \int_\Omega f \cdot u \, dx
$$

#### 实现步骤：
1. **积分点设置**：Gauss-Legendre 积分节点（40×40）
2. **损失函数**：数值积分的能量泛函
3. **训练**：Adam 优化器，5000 epochs
4. **可视化**：解的对比与误差分析

### 5. 结果可视化
- 训练损失收敛曲线
- 精确解 vs TNN 预测对比
- 绝对误差分布热力图
- 中心线剖面对比
- L2 误差和最大误差指标

### 6. 总结与扩展
- TNN 在高维问题中的优势
- 进阶主题指引：
  - 非齐次边界条件（ex_5_2）
  - Neumann 边界条件（ex_5_3）
  - 特征值问题（ex_5_4）
  - 无界域（ex_5_5）
  - 更高维度（5D、10D、20D 示例）

## 环境要求

```bash
pip install torch numpy matplotlib
```

## 使用方法

打开 Jupyter notebook 并按顺序运行单元格：

```bash
jupyter notebook TNN_tutorial.ipynb
```

本教程自包含，包括：
- ✅ 所有必要的导入
- ✅ 完整的代码实现
- ✅ 数学推导说明
- ✅ 可视化示例
- ✅ 可运行的 2D Poisson 方程演示

## 主要特点

1. **从零实现**：逐步构建 TNN，配有清晰解释
2. **数学严谨**：详细的推导和变分公式
3. **实际案例**：从问题定义到可视化的完整流程
4. **中文讲解**：所有解释均为中文，便于理解
5. **可执行代码**：所有单元格可直接运行复现结果

## 预期结果

训练后（5000 epochs，rank=50）：
- **L2 误差**：约 10⁻⁴ ~ 10⁻⁵
- **最大误差**：约 10⁻³ ~ 10⁻⁴
- **训练时间**：约 2-5 分钟（CPU）

## 学习成果

完成本教程后，您将：
- ✅ 理解神经网络的张量分解
- ✅ 使用 PyTorch 从零实现 TNN
- ✅ 掌握自动边界条件强制方法
- ✅ 应用变分方法求解 PDE
- ✅ 使用 Gauss-Legendre 积分进行数值积分
- ✅ 可视化和分析 PDE 解

## 参考资料

更多进阶示例请参见 `../example/` 目录：
- `ex_5_1/`：齐次 Dirichlet 边界条件（5、10、20 维）
- `ex_5_2/`：非齐次边界条件与双 TNN 分解
- `ex_5_3/`：Neumann 边界条件与弱形式
- `ex_5_4/`：特征值问题
- `ex_5_5/`：无界域与 Hermite-Gauss 积分

## 作者

AI4CFD 项目组

## 许可证

见主仓库 LICENSE 文件
