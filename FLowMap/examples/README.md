# Flow Map Learning ç¤ºä¾‹

æœ¬ç›®å½•åŒ…å«ä½¿ç”¨ Flow Map Learning æ±‚è§£åŠ¨åŠ›ç³»ç»Ÿå’Œ PDE çš„å®Œæ•´ç¤ºä¾‹ã€‚

## ğŸ“ ç¤ºä¾‹åˆ—è¡¨

| æ–‡ä»¶ | é—®é¢˜ç±»å‹ | éš¾åº¦ | æè¿° |
|------|---------|------|------|
| [lorenz_system.py](lorenz_system.py) | åŠ¨åŠ›ç³»ç»Ÿ | â­â­ åŸºç¡€ | Lorenz æ··æ²Œç³»ç»Ÿé¢„æµ‹ |
| [heat_equation_flowmap.py](heat_equation_flowmap.py) | PDE | â­â­ åŸºç¡€ | 1D çƒ­ä¼ å¯¼æ–¹ç¨‹æ—¶é—´æ¼”åŒ– |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œç¤ºä¾‹

```bash
# Lorenz æ··æ²Œç³»ç»Ÿ
python lorenz_system.py

# çƒ­ä¼ å¯¼æ–¹ç¨‹
python heat_equation_flowmap.py
```

## ğŸ“Š ç¤ºä¾‹è¯¦è§£

### 1. Lorenz æ··æ²Œç³»ç»Ÿ (lorenz_system.py)

**é—®é¢˜æè¿°**:

Lorenz ç³»ç»Ÿæ˜¯ç»å…¸çš„æ··æ²ŒåŠ¨åŠ›ç³»ç»Ÿï¼š

$$
\begin{cases}
\frac{dx}{dt} = \sigma(y - x) \\
\frac{dy}{dt} = x(\rho - z) - y \\
\frac{dz}{dt} = xy - \beta z
\end{cases}
$$

ä½¿ç”¨æ ‡å‡†æ··æ²Œå‚æ•°ï¼š$\sigma = 10$, $\rho = 28$, $\beta = 8/3$

**Flow Map æ–¹æ³•**:

å­¦ä¹ ä» $(x_n, y_n, z_n)$ åˆ° $(x_{n+1}, y_{n+1}, z_{n+1})$ çš„æ˜ å°„ï¼š

$$
\mathbf{x}_{n+1} = \Phi_{\Delta t}(\mathbf{x}_n) \approx \mathcal{N}_\theta(\mathbf{x}_n, \Delta t)
$$

**å…³é”®ä»£ç **:

```python
from models import FlowMapMLP

# åˆ›å»ºæ¨¡å‹
model = FlowMapMLP(
    state_dim=3,           # Lorenz ç³»ç»Ÿæ˜¯3ç»´
    hidden_dims=[128, 128, 128],
    activation='tanh',
    use_residual=True,     # æ®‹å·®è¿æ¥
    time_encoding=True     # æ—¶é—´ç¼–ç 
)

# å¤šæ­¥é¢„æµ‹
trajectory = model.multi_step_predict(x0, dt, n_steps=1000)
```

**é¢„æœŸç»“æœ**:
- çŸ­æœŸé¢„æµ‹ï¼ˆ~5ç§’ï¼‰ï¼šéå¸¸å‡†ç¡®
- é•¿æœŸé¢„æµ‹ï¼šç”±äºæ··æ²Œç‰¹æ€§ï¼Œè¯¯å·®ä¼šç´¯ç§¯
- å­¦åˆ°æ­£ç¡®çš„å¸å¼•å­ç»“æ„

---

### 2. çƒ­ä¼ å¯¼æ–¹ç¨‹ (heat_equation_flowmap.py)

**é—®é¢˜æè¿°**:

1D çƒ­ä¼ å¯¼æ–¹ç¨‹ï¼š

$$
\frac{\partial u}{\partial t} = \alpha \frac{\partial^2 u}{\partial x^2}, \quad x \in [0, 1]
$$

**è¾¹ç•Œæ¡ä»¶**: $u(0, t) = u(1, t) = 0$

**åˆå§‹æ¡ä»¶**: $u(x, 0) = \sin(\pi x)$

**è§£æè§£**: $u(x, t) = \sin(\pi x) e^{-\alpha \pi^2 t}$

**Flow Map æ–¹æ³•**:

ä½¿ç”¨ CNN å­¦ä¹ åœºé‡çš„æ—¶é—´æ¼”åŒ–ï¼š

$$
\mathbf{u}^{n+1} = \Phi_{\Delta t}(\mathbf{u}^n)
$$

å…¶ä¸­ $\mathbf{u}^n = [u(x_1, t_n), u(x_2, t_n), \ldots, u(x_N, t_n)]$

**å…³é”®ä»£ç **:

```python
from models import FlowMapCNN

# åˆ›å»ºæ¨¡å‹
model = FlowMapCNN(
    in_channels=1,         # å•ä¸ªç‰©ç†åœº
    hidden_channels=32,
    num_layers=4,
    kernel_size=5,
    use_residual=True
)

# å¤šæ­¥é¢„æµ‹
predictions = model.multi_step_predict(u0, dt, n_steps=1000)
```

**é¢„æœŸç»“æœ**:
- é•¿æœŸç¨³å®šçš„é¢„æµ‹
- è¯¯å·®ä¿æŒåœ¨è¾ƒä½æ°´å¹³
- æ­£ç¡®æ•æ‰æ‰©æ•£è¿‡ç¨‹

## ğŸ“ˆ ç»“æœå¯¹æ¯”

| é—®é¢˜ | é¢„æµ‹æ­¥æ•° | ç›¸å¯¹è¯¯å·® | è®­ç»ƒæ—¶é—´ |
|------|---------|---------|---------|
| Lorenz (çŸ­æœŸ) | 500 | < 1% | ~1 min |
| Lorenz (é•¿æœŸ) | 2500 | ~10-50% | ~1 min |
| çƒ­ä¼ å¯¼ | 1000 | < 1% | ~2 min |

## ğŸ’¡ æŠ€å·§ä¸å»ºè®®

### Lorenz ç³»ç»Ÿ

1. **æ··æ²Œç³»ç»Ÿçš„å›ºæœ‰é™åˆ¶**ï¼šæ··æ²Œç³»ç»Ÿå¯¹åˆå§‹æ¡ä»¶æå…¶æ•æ„Ÿï¼Œé•¿æœŸç²¾ç¡®é¢„æµ‹æ˜¯ä¸å¯èƒ½çš„
2. **çŸ­æœŸé¢„æµ‹**ï¼šFlow Map åœ¨çŸ­æœŸé¢„æµ‹ä¸Šè¡¨ç°ä¼˜å¼‚
3. **ç»Ÿè®¡æ€§è´¨**ï¼šè™½ç„¶å•æ¡è½¨è¿¹å¯èƒ½åç¦»ï¼Œä½†å­¦åˆ°çš„ç»Ÿè®¡æ€§è´¨ï¼ˆå¦‚å¸å¼•å­å½¢çŠ¶ï¼‰æ˜¯æ­£ç¡®çš„

### çƒ­ä¼ å¯¼æ–¹ç¨‹

1. **CFL æ¡ä»¶**ï¼šç”Ÿæˆè®­ç»ƒæ•°æ®æ—¶éœ€æ»¡è¶³ CFL æ¡ä»¶
2. **è¾¹ç•Œå¤„ç†**ï¼šCNN çš„ padding ç­–ç•¥ä¼šå½±å“è¾¹ç•Œç²¾åº¦
3. **é•¿æœŸç¨³å®šæ€§**ï¼šçƒ­ä¼ å¯¼æ˜¯è€—æ•£ç³»ç»Ÿï¼ŒFlow Map å®¹æ˜“ä¿æŒç¨³å®š

## ğŸ”§ æ‰©å±•ç»ƒä¹ 

1. **ä¸åŒåˆå§‹æ¡ä»¶**ï¼šå°è¯•ä¸åŒçš„åˆå§‹æ¡ä»¶æµ‹è¯•æ³›åŒ–èƒ½åŠ›
2. **å¤šå°ºåº¦è®­ç»ƒ**ï¼šåŒæ—¶ä½¿ç”¨å¤šä¸ªæ—¶é—´æ­¥é•¿è¿›è¡Œè®­ç»ƒ
3. **å…¶ä»–åŠ¨åŠ›ç³»ç»Ÿ**ï¼šå°è¯• Van der Polã€åŒæ‘†ç­‰ç³»ç»Ÿ
4. **2D çƒ­ä¼ å¯¼**ï¼šå°† CNN æ‰©å±•åˆ° 2D æƒ…å†µ

## ğŸ“š ç›¸å…³èµ„æº

- [../README.md](../README.md): Flow Map æ–¹æ³•æ¦‚è¿°
- [../tutorial/](../tutorial/): å®Œæ•´æ•™ç¨‹ notebook
- [../../PINNs/](../../PINNs/): PINNs æ–¹æ³•å¯¹æ¯”
